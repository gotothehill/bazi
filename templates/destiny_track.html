<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>命运轨迹 - 基于八字的人生模拟</title>
    <!-- Markdown解析库 -->
    <script src="/static/libs/marked.min.js"></script>
    <link rel="stylesheet" href="/static/css/destiny_track.css?v=2">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">

</head>

<body>
    <div class="container">
        <div class="header">
            <h1>🎭 命运轨迹</h1>
            <p>基于八字命理的人生模拟游戏</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="bazi-info" id="baziInfo">
                    <h3>📊 命盘信息</h3>
                    <div class="info-item">正在加载...</div>
                </div>

                <div class="life-stages-container">
                    <div id="lifeStages">
                        <!-- 人生阶段会动态生成 -->
                    </div>
                </div>

                <div class="ai-config-panel" id="aiConfigPanel">
                    <h4>🤖 AI配置</h4>
                    <div class="config-status" id="configStatus">
                        <span style="color: #ff6b6b;">未配置</span>
                    </div>
                    <button class="control-btn" onclick="showAIConfig()" id="configBtn">⚙️ 配置AI</button>
                </div>

                <div class="stats-panel">
                    <h4>📈 人生数据</h4>
                    <div class="stat-item">
                        <span>年龄</span>
                        <span id="currentAge">0岁</span>
                    </div>
                    <div class="stat-item">
                        <span>命运值</span>
                        <span id="destinyScore">100</span>
                    </div>
                    <div class="stat-item">
                        <span>事件计数</span>
                        <span id="eventCount">0</span>
                    </div>
                </div>

                <div class="control-buttons">
                    <button class="control-btn" onclick="resetGame()">🔄 重新开始</button>
                    <button class="control-btn" onclick="window.close()">🏠 返回主页</button>
                </div>
            </div>

            <div class="game-area">
                <!-- 游戏设置界面 -->
                <div class="game-settings" id="gameSettings">
                    <div class="settings-title">🎭 命运轨迹设置</div>
                    <div class="settings-content">
                        <div class="setting-group">
                            <h4>📖 故事风格</h4>
                            <div class="style-options">
                                <label class="style-option">
                                    <input type="radio" name="storyStyle" value="realistic" checked>
                                    <div class="option-card">
                                        <div class="option-icon">🌍</div>
                                        <div class="option-title">现实写实</div>
                                        <div class="option-desc">基于真实历史事件和社会背景，模拟真实人生轨迹</div>
                                    </div>
                                </label>

                                <label class="style-option">
                                    <input type="radio" name="storyStyle" value="fantasy">
                                    <div class="option-card">
                                        <div class="option-icon">🔮</div>
                                        <div class="option-title">奇幻冒险</div>
                                        <div class="option-desc">融入奇幻元素，命理法则化为魔法力量的冒险世界</div>
                                    </div>
                                </label>

                                <label class="style-option">
                                    <input type="radio" name="storyStyle" value="historical">
                                    <div class="option-card">
                                        <div class="option-icon">🏛️</div>
                                        <div class="option-title">古代传奇</div>
                                        <div class="option-desc">穿越古代，体验传统命理在历史背景下的人生</div>
                                    </div>
                                </label>

                                <label class="style-option">
                                    <input type="radio" name="storyStyle" value="modern">
                                    <div class="option-card">
                                        <div class="option-icon">🏙️</div>
                                        <div class="option-title">都市传说</div>
                                        <div class="option-desc">现代都市背景，命理与科技的奇妙融合</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="setting-group" id="realisticOptions">
                            <h4>⏰ 开始时间</h4>
                            <div class="time-options">
                                <label class="time-option">
                                    <input type="radio" name="startTime" value="birth" checked>
                                    <div class="time-card">
                                        <div class="time-icon">👶</div>
                                        <div class="time-title">从出生开始</div>
                                        <div class="time-desc">完整体验人生轨迹，见证历史变迁</div>
                                    </div>
                                </label>

                                <label class="time-option">
                                    <input type="radio" name="startTime" value="current">
                                    <div class="time-card">
                                        <div class="time-icon">📅</div>
                                        <div class="time-title">从现在开始</div>
                                        <div class="time-desc">基于当前年龄，展望未来人生</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="setting-actions">
                            <button class="start-game-btn" onclick="startGameWithSettings()">
                                🚀 开始命运之旅
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 游戏主界面 -->
                <div class="story-section" id="storySection" style="display: none;">
                    <div class="story-title" id="storyTitle">命运的开始</div>
                    <div class="story-content" id="storyContent">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            正在根据您的八字排盘生成专属剧情...
                        </div>
                    </div>
                </div>

                <div class="choices-section" id="choicesSection" style="display: none;">
                    <div class="choices-title">🤔 您会如何选择？</div>
                    <div id="choicesList">
                        <!-- 选择按钮会动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 右侧浮动人生轨迹面板 -->
            <div class="trajectory-panel" id="trajectoryPanel">
                <div class="history-panel" id="historyPanel">
                    <h4>📜 人生轨迹</h4>
                    <div id="historyContent">
                        <div class="empty-history">暂无历史记录</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI配置模态框 -->
        <div id="aiConfigModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🤖 AI配置设置</h3>
                    <button class="close-btn" onclick="hideAIConfig()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="modalAiProvider">AI服务商</label>
                        <select id="modalAiProvider" onchange="updateModalAIConfig()">
                            <option value="openai">OpenAI (GPT)</option>
                            <option value="claude">Anthropic (Claude)</option>
                            <option value="deepseek">DeepSeek</option>
                            <option value="custom">自定义服务商</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="modalAiModel">AI模型</label>
                        <select id="modalAiModel">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            <option value="gpt-4">GPT-4</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="modalAiApiKey">API Key</label>
                        <input type="password" id="modalAiApiKey" placeholder="请输入您的API Key">
                    </div>
                    <div class="form-group">
                        <label for="modalAiApiUrl">API地址 (可选)</label>
                        <input type="text" id="modalAiApiUrl" placeholder="留空使用默认地址">
                    </div>
                    <div class="form-group" id="modalCustomModelGroup" style="display: none;">
                        <label for="modalCustomModel">自定义模型名</label>
                        <input type="text" id="modalCustomModel" placeholder="输入自定义模型名">
                    </div>
                    <div class="form-group" id="modalCustomHeaderGroup" style="display: none;">
                        <label for="modalCustomHeaders">自定义Headers (JSON格式)</label>
                        <textarea id="modalCustomHeaders" placeholder='{"X-Custom-Header": "value"}'
                            rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn cancel" onclick="hideAIConfig()">取消</button>
                    <button class="modal-btn save" onclick="saveAIConfig()">保存配置</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/destiny_track.js" defer></script>
</body>

</html>