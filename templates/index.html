<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…«å­—ç”Ÿè‚–åˆ†æç³»ç»Ÿ</title>
    <!-- Markdownè§£æåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .form-section {
            padding: 40px;
            background: #f8f9fa;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4ECDC4;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .submit-btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: block;
            margin: 30px auto 0;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .copy-btn {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 1em;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin: 10px 5px 0 0;
            display: inline-block;
        }
        
        .copy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .copy-btn:active {
            transform: translateY(0);
        }
        
        .copy-success {
            background: linear-gradient(45deg, #00b894, #00a085) !important;
        }
        
        .copy-actions {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .ai-config-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .ai-config-toggle {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }
        
        .ai-config-toggle:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .ai-config-form {
            display: none;
            margin-top: 15px;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .ai-config-form.show {
            display: grid;
        }
        
        .ai-interpret-btn {
            background: linear-gradient(45deg, #a29bfe, #6c5ce7);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin: 15px 10px 0 0;
            display: inline-block;
        }
        
        .ai-interpret-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .ai-interpret-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .destiny-track-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin: 15px 10px 0 0;
            display: inline-block;
        }
        
        .destiny-track-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }
        
        .ai-interpretation {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(240, 147, 251, 0.3);
        }
        
        .ai-interpretation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .ai-interpretation h3 {
            margin: 0;
            font-size: 1.3em;
        }
        
        .ai-collapse-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .ai-collapse-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .ai-interpretation .content {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 8px;
            line-height: 1.6;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .ai-interpretation .content.collapsed {
            max-height: 0;
            padding: 0 20px;
            opacity: 0;
        }
        
        .ai-interpretation-content {
            transition: all 0.3s ease;
        }
        
        .ai-interpretation .content h1,
        .ai-interpretation .content h2,
        .ai-interpretation .content h3 {
            color: #fff;
            margin: 15px 0 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 5px;
        }
        
        .ai-interpretation .content h1 {
            font-size: 1.5em;
        }
        
        .ai-interpretation .content h2 {
            font-size: 1.3em;
        }
        
        .ai-interpretation .content h3 {
            font-size: 1.1em;
        }
        
        .ai-interpretation .content p {
            margin: 10px 0;
            line-height: 1.8;
        }
        
        .ai-interpretation .content ul,
        .ai-interpretation .content ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .ai-interpretation .content li {
            margin: 5px 0;
            line-height: 1.6;
        }
        
        .ai-interpretation .content strong {
            color: #ffd700;
            font-weight: bold;
        }
        
        .ai-interpretation .content em {
            color: #ffc0cb;
            font-style: italic;
        }
        
        .ai-interpretation .content blockquote {
            border-left: 4px solid rgba(255,255,255,0.5);
            padding-left: 15px;
            margin: 15px 0;
            font-style: italic;
            opacity: 0.9;
        }
        
        .ai-interpretation .content code {
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        
        .ai-interpretation .content pre {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .ai-interpretation .content pre code {
            background: none;
            padding: 0;
        }
        
        .streaming-cursor {
            display: inline-block;
            width: 2px;
            height: 1em;
            background: white;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .ai-loading {
            text-align: center;
            padding: 20px;
            color: #6c5ce7;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .ai-config-form {
                grid-template-columns: 1fr;
            }
        }
        
        .results-section {
            padding: 40px;
            display: none;
        }
        
        .result-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #4ECDC4;
        }
        
        .result-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
        }
        
        .result-card h3::before {
            content: "ğŸ”®";
            margin-right: 10px;
            font-size: 1.2em;
        }
        
        .shengxiao-card h3::before {
            content: "ğŸ²";
        }
        
        .basic-info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .basic-info h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .info-item {
            display: inline-block;
            background: white;
            padding: 8px 15px;
            margin: 5px 10px 5px 0;
            border-radius: 20px;
            border: 1px solid #ddd;
            font-weight: bold;
        }
        
        .bazi-content {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #2c3e50;
            padding: 25px;
            border-radius: 12px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            white-space: pre;
            overflow-x: auto;
            font-size: 0.85em;
            line-height: 1.4;
            border: 1px solid #dee2e6;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
            width: 100%;
            min-height: 500px;
        }
        
        .bazi-container {
            width: 100%;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .bazi-table {
            width: max-content;
            min-width: 100%;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            white-space: nowrap;
        }
        
        .bazi-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
            border-left: 4px solid #74b9ff;
        }
        
        .bazi-header {
            color: #2d3436;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
            padding-bottom: 8px;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        .bazi-row {
            margin: 8px 0;
            padding: 6px 0;
        }
        
        .bazi-highlight {
            color: #e17055;
            font-weight: bold;
        }
        
        .bazi-number {
            color: #0984e3;
            font-weight: bold;
        }
        
        .bazi-element {
            color: #00b894;
            font-weight: bold;
        }
        
        .shengxiao-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        
        .compatible, .incompatible {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
        }
        
        .compatible {
            border-left: 4px solid #4caf50;
        }
        
        .incompatible {
            border-left: 4px solid #f44336;
        }
        
        .compatible h5, .incompatible h5 {
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .compatible h5 {
            color: #4caf50;
        }
        
        .incompatible h5 {
            color: #f44336;
        }
        
        .zodiac-list {
            margin: 5px 0;
        }
        
        .zodiac-list strong {
            color: #666;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading::after {
            content: "";
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4ECDC4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #c62828;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .shengxiao-details {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .form-section, .results-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”® å…«å­—ç”Ÿè‚–åˆ†æç³»ç»Ÿ</h1>
            <p>åŸºäºä¼ ç»Ÿå‘½ç†å­¦ï¼Œä¸ºæ‚¨æä¾›ä¸“ä¸šçš„å…«å­—å’Œç”Ÿè‚–åˆ†æ</p>
        </div>
        
        <div class="form-section">
            <form id="analysisForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="birthYear">å‡ºç”Ÿå¹´ä»½</label>
                        <select id="birthYear" name="birthYear" required></select>
                    </div>
                    <div class="form-group">
                        <label for="birthMonth">å‡ºç”Ÿæœˆä»½</label>
                        <select id="birthMonth" name="birthMonth" required></select>
                    </div>
                    <div class="form-group">
                        <label for="birthDay">å‡ºç”Ÿæ—¥æœŸ</label>
                        <select id="birthDay" name="birthDay" required></select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="calendarType">å†æ³•ç±»å‹</label>
                        <select id="calendarType" name="calendarType">
                            <option value="å†œå†" selected>å†œå†</option>
                            <option value="å…¬å†">å…¬å†</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="birthTime">å‡ºç”Ÿæ—¶è¾°</label>
                        <select id="birthTime" name="birthTime">
                            <option value="0">å­æ—¶ (23:00-01:00)</option>
                            <option value="1">ä¸‘æ—¶ (01:00-03:00)</option>
                            <option value="3">å¯…æ—¶ (03:00-05:00)</option>
                            <option value="5">å¯æ—¶ (05:00-07:00)</option>
                            <option value="7">è¾°æ—¶ (07:00-09:00)</option>
                            <option value="8" selected>å·³æ—¶ (09:00-11:00)</option>
                            <option value="11">åˆæ—¶ (11:00-13:00)</option>
                            <option value="13">æœªæ—¶ (13:00-15:00)</option>
                            <option value="15">ç”³æ—¶ (15:00-17:00)</option>
                            <option value="17">é…‰æ—¶ (17:00-19:00)</option>
                            <option value="19">æˆŒæ—¶ (19:00-21:00)</option>
                            <option value="21">äº¥æ—¶ (21:00-23:00)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gender">æ€§åˆ«</label>
                        <select id="gender" name="gender">
                            <option value="ç”·">ç”·</option>
                            <option value="å¥³">å¥³</option>
                        </select>
                    </div>
                </div>
                
                <button type="submit" class="submit-btn" id="submitBtn">å¼€å§‹åˆ†æ</button>
            </form>
        </div>
        
        <div class="results-section" id="resultsSection">
            <div class="loading" id="loading">æ­£åœ¨åˆ†æä¸­ï¼Œè¯·ç¨å€™...</div>
            <div id="results" style="display: none;"></div>
        </div>
    </div>

    <script>
        document.getElementById('analysisForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const year = formData.get('birthYear');
            const month = formData.get('birthMonth').padStart(2, '0');
            const day = formData.get('birthDay').padStart(2, '0');
            
            const data = {
                birth_date: `${year}-${month}-${day}`,
                birth_time: formData.get('birthTime'),
                gender: formData.get('gender'),
                calendar_type: formData.get('calendarType')
            };
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').textContent = 'åˆ†æä¸­...';
            
            // è°ƒç”¨API
            fetch('/api/complete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                document.getElementById('loading').style.display = 'none';
                
                if (result.success) {
                    displayResults(result);
                } else {
                    let errorMsg = result.error || 'åˆ†æå¤±è´¥ï¼Œè¯·é‡è¯•';
                    if (result.debug_info) {
                        errorMsg += `\n\nè°ƒè¯•ä¿¡æ¯:\nå‘½ä»¤: ${result.debug_info.command}\nè¿”å›ç : ${result.debug_info.return_code}\né”™è¯¯: ${result.debug_info.stderr}`;
                    }
                    displayError(errorMsg);
                }
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                displayError('ç½‘ç»œé”™è¯¯ï¼š' + error.message);
            })
            .finally(() => {
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('submitBtn').textContent = 'å¼€å§‹åˆ†æ';
            });
        });
        
        function displayResults(data) {
            // ä¿å­˜æ•°æ®åˆ°å…¨å±€å˜é‡ä¾›å¤åˆ¶åŠŸèƒ½ä½¿ç”¨
            currentAnalysisData = data;
            
            const resultsDiv = document.getElementById('results');
            const birthInfo = data.birth_info;
            const shengxiaoAnalysis = data.shengxiao_analysis;
            const baziAnalysis = data.bazi_analysis;
            
            resultsDiv.innerHTML = `
                <div class="basic-info">
                    <h4>ğŸ“‹ åŸºæœ¬ä¿¡æ¯</h4>
                    <span class="info-item">ğŸ“… ${birthInfo.date} (${birthInfo.calendar_type})</span>
                    <span class="info-item">â° ${getTimeLabel(birthInfo.time)}</span>
                    <span class="info-item">ğŸ‘¤ ${birthInfo.gender}</span>
                    <span class="info-item">ğŸ² ${birthInfo.shengxiao}</span>
                </div>
                
                <div class="copy-actions">
                    <button class="copy-btn" onclick="copyShengxiaoInfo()">ğŸ“‹ å¤åˆ¶ç”Ÿè‚–ä¿¡æ¯</button>
                    <button class="copy-btn" onclick="copyBaziInfo()">ğŸ“‹ å¤åˆ¶å…«å­—æ’ç›˜</button>
                    <button class="copy-btn" onclick="copyAllInfo()">ğŸ“‹ å¤åˆ¶å…¨éƒ¨ä¿¡æ¯</button>
                </div>
                
                <div class="ai-config-section">
                    <h4>ğŸ¤– AIæ™ºèƒ½è§£è¯»</h4>
                    <p>é…ç½®AI APIä¿¡æ¯ï¼Œè·å¾—ä¸“ä¸šçš„å‘½ç†è§£è¯»</p>
                    <button class="ai-config-toggle" onclick="toggleAIConfig()">âš™ï¸ é…ç½®AIè®¾ç½®</button>
                    
                    <div class="ai-config-form" id="aiConfigForm">
                        <div class="form-group">
                            <label for="aiProvider">AIæœåŠ¡å•†</label>
                            <select id="aiProvider" onchange="updateAIConfig()">
                                <option value="openai">OpenAI (GPT)</option>
                                <option value="claude">Anthropic (Claude)</option>
                                <option value="deepseek">DeepSeek</option>
                                <option value="custom">è‡ªå®šä¹‰æœåŠ¡å•†</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="aiModel">AIæ¨¡å‹</label>
                            <select id="aiModel">
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                <option value="gpt-4">GPT-4</option>
                                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="aiApiKey">API Key</label>
                            <input type="password" id="aiApiKey" placeholder="è¯·è¾“å…¥æ‚¨çš„API Key">
                        </div>
                        <div class="form-group">
                            <label for="aiApiUrl">APIåœ°å€ (å¯é€‰)</label>
                            <input type="text" id="aiApiUrl" placeholder="è‡ªå®šä¹‰APIåœ°å€ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤">
                        </div>
                        
                        <div class="form-group custom-only" id="customModelGroup" style="display: none;">
                            <label for="customModel">è‡ªå®šä¹‰æ¨¡å‹å</label>
                            <input type="text" id="customModel" placeholder="è¾“å…¥è‡ªå®šä¹‰æ¨¡å‹åç§°">
                        </div>
                        
                        <div class="form-group custom-only" id="customHeaderGroup" style="display: none;">
                            <label for="customHeaders">è‡ªå®šä¹‰Headers (JSONæ ¼å¼ï¼Œå¯é€‰)</label>
                            <textarea id="customHeaders" placeholder='{"X-Custom-Header": "value"}' rows="3"></textarea>
                        </div>
                    </div>
                    
                    <button class="ai-interpret-btn" id="aiInterpretBtn" onclick="getAIInterpretation()">
                        ğŸ§  AIæ™ºèƒ½è§£è¯»
                    </button>
                    
                    <button class="destiny-track-btn" id="destinyTrackBtn" onclick="openDestinyTrack()" style="display: none;">
                        ğŸ­ å‘½è¿è½¨è¿¹
                    </button>
                </div>
                
                <div id="aiInterpretationResult" style="display: none;"></div>
                
                <div class="result-card shengxiao-card">
                    <h3>ç”Ÿè‚–åˆ†æ - ${birthInfo.shengxiao}</h3>
                    <p><strong>å¹´æ”¯ï¼š</strong>${shengxiaoAnalysis.year_zhi}</p>
                    
                    <div class="shengxiao-details">
                        <div class="compatible">
                            <h5>ğŸ’• ç›¸åˆç”Ÿè‚–</h5>
                            <div class="zodiac-list"><strong>ä¸‰åˆï¼š</strong>${shengxiaoAnalysis.compatible.sanhe.join('ã€') || 'æ— '}</div>
                            <div class="zodiac-list"><strong>å…­åˆï¼š</strong>${shengxiaoAnalysis.compatible.liuhe.join('ã€') || 'æ— '}</div>
                            <div class="zodiac-list"><strong>ä¸‰ä¼šï¼š</strong>${shengxiaoAnalysis.compatible.sanhui.join('ã€') || 'æ— '}</div>
                        </div>
                        
                        <div class="incompatible">
                            <h5>âš ï¸ ä¸åˆç”Ÿè‚–</h5>
                            <div class="zodiac-list"><strong>ç›¸å†²ï¼š</strong>${shengxiaoAnalysis.incompatible.chong.join('ã€') || 'æ— '}</div>
                            <div class="zodiac-list"><strong>ç›¸åˆ‘ï¼š</strong>${shengxiaoAnalysis.incompatible.xing.join('ã€') || 'æ— '}</div>
                            <div class="zodiac-list"><strong>è¢«åˆ‘ï¼š</strong>${shengxiaoAnalysis.incompatible.beixing.join('ã€') || 'æ— '}</div>
                            <div class="zodiac-list"><strong>ç›¸å®³ï¼š</strong>${shengxiaoAnalysis.incompatible.hai.join('ã€') || 'æ— '}</div>
                            <div class="zodiac-list"><strong>ç›¸ç ´ï¼š</strong>${shengxiaoAnalysis.incompatible.po.join('ã€') || 'æ— '}</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <p><strong>ğŸ’¡ è¯´æ˜ï¼š</strong>åˆç”Ÿè‚–æ˜¯åˆå…«å­—çš„ä¸€å°éƒ¨åˆ†ï¼Œæœ‰ä¸€å®šå‚è€ƒæ„ä¹‰ï¼Œä½†ä¸æ˜¯å…¨éƒ¨ã€‚åˆå©šè¯·ä»¥å…«å­—ä¸ºå‡†ã€‚å¦‚æœç”Ÿè‚–åŒæ—¶åœ¨ç›¸åˆä¸ä¸åˆä¸­ï¼Œåˆ™åšåŠ å‡å³å¯ã€‚</p>
                    </div>
                </div>
                
                <div class="result-card">
                    <h3>å…«å­—è¯¦ç»†åˆ†æ</h3>
                    <div class="bazi-content">${formatBaziContent(baziAnalysis)}</div>
                </div>
            `;
            
            resultsDiv.style.display = 'block';
            
            // æ˜¾ç¤ºå‘½è¿è½¨è¿¹æŒ‰é’®
            const destinyTrackBtn = document.getElementById('destinyTrackBtn');
            if (destinyTrackBtn) {
                destinyTrackBtn.style.display = 'inline-block';
            }
        }
        
        function displayError(message) {
            const resultsDiv = document.getElementById('results');
            const formattedMessage = message.replace(/\n/g, '<br>');
            resultsDiv.innerHTML = `<div class="error">âŒ ${formattedMessage}</div>`;
            resultsDiv.style.display = 'block';
        }
        
        function getTimeLabel(hour) {
            const timeLabels = {
                '0': 'å­æ—¶ (23:00-01:00)',
                '1': 'ä¸‘æ—¶ (01:00-03:00)',
                '3': 'å¯…æ—¶ (03:00-05:00)',
                '5': 'å¯æ—¶ (05:00-07:00)',
                '7': 'è¾°æ—¶ (07:00-09:00)',
                '8': 'å·³æ—¶ (09:00-11:00)',
                '11': 'åˆæ—¶ (11:00-13:00)',
                '13': 'æœªæ—¶ (13:00-15:00)',
                '15': 'ç”³æ—¶ (15:00-17:00)',
                '17': 'é…‰æ—¶ (17:00-19:00)',
                '19': 'æˆŒæ—¶ (19:00-21:00)',
                '21': 'äº¥æ—¶ (21:00-23:00)'
            };
            return timeLabels[hour] || `${hour}ç‚¹`;
        }
        
        function cleanAnsiCodes(text) {
            // æ¸…ç†ANSIé¢œè‰²ä»£ç 
            return text.replace(/\x1b\[[0-9;]*m/g, '');
        }
        
        function formatBaziContent(text) {
            if (!text) return 'æš‚æ— åˆ†æç»“æœ';
            
            // æ¸…ç†ANSIä»£ç ä½†ä¿æŒåŸå§‹æ ¼å¼
            let cleanText = cleanAnsiCodes(text);
            
            // è¿‡æ»¤æ¨å¹¿ä¿¡æ¯
            let lines = cleanText.split('\n');
            let filteredLines = [];
            
            for (let line of lines) {
                // è¿‡æ»¤æ¨å¹¿ä¿¡æ¯
                if (line.includes('å»ºè®®å‚è§') || line.includes('t.cn') || line.includes('http')) {
                    continue;
                }
                filteredLines.push(line);
            }
            
            return filteredLines.join('\n');
        }
        
        // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
        function initializeDateSelectors() {
            const currentYear = new Date().getFullYear();
            const yearSelect = document.getElementById('birthYear');
            const monthSelect = document.getElementById('birthMonth');
            const daySelect = document.getElementById('birthDay');
            
            // ç”Ÿæˆå¹´ä»½é€‰é¡¹ (1900-å½“å‰å¹´ä»½)
            for (let year = currentYear; year >= 1900; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'å¹´';
                if (year === 1990) option.selected = true; // é»˜è®¤é€‰æ‹©1990å¹´
                yearSelect.appendChild(option);
            }
            
            // ç”Ÿæˆæœˆä»½é€‰é¡¹
            for (let month = 1; month <= 12; month++) {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month + 'æœˆ';
                if (month === 1) option.selected = true; // é»˜è®¤é€‰æ‹©1æœˆ
                monthSelect.appendChild(option);
            }
            
            // ç”Ÿæˆæ—¥æœŸé€‰é¡¹
            function updateDays() {
                const selectedYear = parseInt(yearSelect.value);
                const selectedMonth = parseInt(monthSelect.value);
                const daysInMonth = new Date(selectedYear, selectedMonth, 0).getDate();
                
                daySelect.innerHTML = '';
                for (let day = 1; day <= daysInMonth; day++) {
                    const option = document.createElement('option');
                    option.value = day;
                    option.textContent = day + 'æ—¥';
                    if (day === 1) option.selected = true; // é»˜è®¤é€‰æ‹©1æ—¥
                    daySelect.appendChild(option);
                }
            }
            
            // åˆå§‹åŒ–æ—¥æœŸ
            updateDays();
            
            // å¹´ä»½æˆ–æœˆä»½æ”¹å˜æ—¶æ›´æ–°æ—¥æœŸ
            yearSelect.addEventListener('change', updateDays);
            monthSelect.addEventListener('change', updateDays);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializeDateSelectors);
        
        // å…¨å±€å˜é‡å­˜å‚¨åˆ†æç»“æœ
        let currentAnalysisData = null;
        
        // AIé…ç½®å’Œè§£è¯»åŠŸèƒ½
        function toggleAIConfig() {
            const form = document.getElementById('aiConfigForm');
            form.classList.toggle('show');
            
            const button = event.target;
            button.textContent = form.classList.contains('show') ? 
                'âš™ï¸ éšè—AIè®¾ç½®' : 'âš™ï¸ é…ç½®AIè®¾ç½®';
        }
        
        function updateAIConfig() {
            const provider = document.getElementById('aiProvider').value;
            const modelSelect = document.getElementById('aiModel');
            const apiUrlInput = document.getElementById('aiApiUrl');
            const customModelGroup = document.getElementById('customModelGroup');
            const customHeaderGroup = document.getElementById('customHeaderGroup');
            
            // éšè—æ‰€æœ‰è‡ªå®šä¹‰å­—æ®µ
            customModelGroup.style.display = 'none';
            customHeaderGroup.style.display = 'none';
            
            // æ ¹æ®æœåŠ¡å•†æ›´æ–°æ¨¡å‹é€‰é¡¹å’ŒAPIåœ°å€æç¤º
            if (provider === 'openai') {
                modelSelect.innerHTML = `
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                    <option value="gpt-4">GPT-4</option>
                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                    <option value="gpt-4o">GPT-4o</option>
                `;
                apiUrlInput.placeholder = "è‡ªå®šä¹‰APIåœ°å€ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤ (https://api.openai.com/v1/chat/completions)";
                apiUrlInput.style.borderColor = "#ddd";
            } else if (provider === 'claude') {
                modelSelect.innerHTML = `
                    <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
                    <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                    <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                `;
                apiUrlInput.placeholder = "è‡ªå®šä¹‰APIåœ°å€ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤ (https://api.anthropic.com/v1/messages)";
                apiUrlInput.style.borderColor = "#ddd";
            } else if (provider === 'deepseek') {
                modelSelect.innerHTML = `
                    <option value="deepseek-chat">DeepSeek Chat</option>
                    <option value="deepseek-coder">DeepSeek Coder</option>
                `;
                apiUrlInput.placeholder = "è‡ªå®šä¹‰APIåœ°å€ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤ (https://api.deepseek.com/v1/chat/completions)";
                apiUrlInput.style.borderColor = "#ddd";
            } else if (provider === 'custom') {
                modelSelect.innerHTML = `
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo (OpenAIå…¼å®¹)</option>
                    <option value="gpt-4">GPT-4 (OpenAIå…¼å®¹)</option>
                    <option value="claude-3-sonnet">Claude-3-Sonnet (Claudeå…¼å®¹)</option>
                    <option value="custom-model">ä½¿ç”¨ä¸‹æ–¹è‡ªå®šä¹‰æ¨¡å‹å</option>
                `;
                apiUrlInput.placeholder = "å¿…å¡«ï¼šè‡ªå®šä¹‰APIåœ°å€ (å¦‚: https://your-api.com/v1/chat/completions)";
                apiUrlInput.style.borderColor = "#ff6b6b";
                
                // æ˜¾ç¤ºè‡ªå®šä¹‰å­—æ®µ
                customModelGroup.style.display = 'block';
                customHeaderGroup.style.display = 'block';
            }
        }
        
        async function getAIInterpretation() {
            if (!currentAnalysisData) {
                alert('è¯·å…ˆå®Œæˆå…«å­—åˆ†æ');
                return;
            }
            
            // è·å–AIé…ç½®
            const provider = document.getElementById('aiProvider').value;
            const model = document.getElementById('aiModel').value;
            const apiKey = document.getElementById('aiApiKey').value;
            const apiUrl = document.getElementById('aiApiUrl').value;
            
            if (!apiKey.trim()) {
                alert('è¯·è¾“å…¥API Key');
                return;
            }
            
            // è‡ªå®šä¹‰æœåŠ¡å•†å¿…é¡»å¡«å†™APIåœ°å€
            if (provider === 'custom' && !apiUrl.trim()) {
                alert('è‡ªå®šä¹‰æœåŠ¡å•†å¿…é¡»å¡«å†™APIåœ°å€');
                return;
            }
            
            let finalModel = model;
            let aiConfig = {
                provider: provider,
                model: finalModel,
                api_key: apiKey.trim()
            };
            
            // å¤„ç†è‡ªå®šä¹‰é…ç½®
            if (provider === 'custom') {
                const customModel = document.getElementById('customModel').value;
                const customHeaders = document.getElementById('customHeaders').value;
                
                // å¦‚æœé€‰æ‹©äº†è‡ªå®šä¹‰æ¨¡å‹ä¸”å¡«å†™äº†æ¨¡å‹åï¼Œä½¿ç”¨è‡ªå®šä¹‰æ¨¡å‹å
                if (model === 'custom-model' && customModel.trim()) {
                    finalModel = customModel.trim();
                    aiConfig.model = finalModel;
                }
                
                // è‡ªå®šä¹‰æœåŠ¡å•†å¿…é¡»æœ‰APIåœ°å€
                aiConfig.api_url = apiUrl.trim();
                
                // æ·»åŠ è‡ªå®šä¹‰headers
                if (customHeaders.trim()) {
                    try {
                        aiConfig.custom_headers = JSON.parse(customHeaders.trim());
                    } catch (e) {
                        alert('è‡ªå®šä¹‰Headersæ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥JSONæ ¼å¼');
                        return;
                    }
                }
            } else {
                // å…¶ä»–æœåŠ¡å•†çš„APIåœ°å€æ˜¯å¯é€‰çš„
                if (apiUrl.trim()) {
                    aiConfig.api_url = apiUrl.trim();
                }
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€å’Œå¯æŠ˜å ç•Œé¢
            const resultDiv = document.getElementById('aiInterpretationResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="ai-interpretation">
                    <div class="ai-interpretation-header">
                        <h3>ğŸ§  AIæ™ºèƒ½è§£è¯»</h3>
                        <button class="ai-collapse-btn" onclick="toggleAIResult()">â–¼</button>
                    </div>
                    <div class="ai-interpretation-content" id="aiContentArea">
                        <div class="ai-loading">ğŸ¤– AIæ­£åœ¨åˆ†æä¸­ï¼Œè¯·ç¨å€™...<span class="streaming-cursor">|</span></div>
                    </div>
                </div>
            `;
            
            const interpretBtn = document.getElementById('aiInterpretBtn');
            interpretBtn.disabled = true;
            interpretBtn.textContent = 'ğŸ¤– AIåˆ†æä¸­...';
            
            try {
                // ä½¿ç”¨æµå¼APIç«¯ç‚¹
                const response = await fetch('/api/ai-interpretation-stream', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        birth_info: currentAnalysisData.birth_info,
                        shengxiao_analysis: currentAnalysisData.shengxiao_analysis,
                        bazi_analysis: currentAnalysisData.bazi_analysis,
                        ai_config: aiConfig
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                }
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                const contentArea = document.getElementById('aiContentArea');
                let fullContent = '';
                
                // æ¸…ç©ºåŠ è½½çŠ¶æ€
                contentArea.innerHTML = '<div class="content"></div>';
                const contentDiv = contentArea.querySelector('.content');
                
                while (true) {
                    const { done, value } = await reader.read();
                    
                    if (done) {
                        break;
                    }
                    
                    const chunk = decoder.decode(value, { stream: true });
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data.trim() === '') continue;
                            
                            try {
                                const parsed = JSON.parse(data);
                                
                                if (parsed.error) {
                                    contentDiv.innerHTML = `
                                        <div class="error">
                                            âŒ AIè§£è¯»å¤±è´¥: ${parsed.error}
                                        </div>
                                    `;
                                    return;
                                }
                                
                                if (parsed.content) {
                                    fullContent += parsed.content;
                                    // å®æ—¶æ¸²æŸ“Markdownå†…å®¹
                                    contentDiv.innerHTML = marked.parse(fullContent) + '<span class="streaming-cursor">|</span>';
                                }
                                
                                if (parsed.done) {
                                    // å®Œæˆæ—¶ç§»é™¤å…‰æ ‡å¹¶æ·»åŠ æ—¶é—´æˆ³
                                    contentDiv.innerHTML = marked.parse(fullContent) + `
                                        <div style="text-align: right; margin-top: 15px; opacity: 0.8; font-size: 0.9em;">
                                            è§£è¯»æ—¶é—´: ${new Date().toLocaleString()}
                                        </div>
                                    `;
                                    break;
                                }
                            } catch (e) {
                                console.error('è§£æJSONé”™è¯¯:', e);
                                continue;
                            }
                        }
                    }
                }
                
            } catch (error) {
                document.getElementById('aiContentArea').innerHTML = `
                    <div class="error">
                        âŒ ç½‘ç»œé”™è¯¯: ${error.message}
                    </div>
                `;
            } finally {
                interpretBtn.disabled = false;
                interpretBtn.textContent = 'ğŸ§  AIæ™ºèƒ½è§£è¯»';
            }
        }
        
        // åˆ‡æ¢AIç»“æœæ˜¾ç¤º/éšè—
        function toggleAIResult() {
            const content = document.querySelector('.ai-interpretation-content');
            const btn = document.querySelector('.ai-collapse-btn');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                btn.textContent = 'â–¼';
            } else {
                content.style.display = 'none';
                btn.textContent = 'â–¶';
            }
        }
        
        // æ‰“å¼€å‘½è¿è½¨è¿¹é¡µé¢
        function openDestinyTrack() {
            if (!currentAnalysisData) {
                alert('è¯·å…ˆå®Œæˆå…«å­—åˆ†æ');
                return;
            }
            
            // è·å–å½“å‰çš„AIé…ç½®
            const provider = document.getElementById('aiProvider').value;
            const model = document.getElementById('aiModel').value;
            const apiKey = document.getElementById('aiApiKey').value;
            const apiUrl = document.getElementById('aiApiUrl').value;
            const customModel = document.getElementById('customModel') ? document.getElementById('customModel').value : '';
            const customHeaders = document.getElementById('customHeaders') ? document.getElementById('customHeaders').value : '';
            
            let aiConfig = null;
            if (apiKey.trim()) {
                aiConfig = {
                    provider: provider,
                    model: model,
                    api_key: apiKey.trim()
                };
                
                if (provider === 'custom') {
                    if (model === 'custom-model' && customModel.trim()) {
                        aiConfig.model = customModel.trim();
                    }
                    if (apiUrl.trim()) {
                        aiConfig.api_url = apiUrl.trim();
                    }
                    if (customHeaders.trim()) {
                        try {
                            aiConfig.custom_headers = JSON.parse(customHeaders.trim());
                        } catch (e) {
                            // å¿½ç•¥JSONè§£æé”™è¯¯
                        }
                    }
                } else if (apiUrl.trim()) {
                    aiConfig.api_url = apiUrl.trim();
                }
            }
            
            // å°†å…«å­—æ•°æ®å’ŒAIé…ç½®å­˜å‚¨åˆ°localStorage
            localStorage.setItem('baziData', JSON.stringify(currentAnalysisData));
            if (aiConfig) {
                localStorage.setItem('destinyAiConfig', JSON.stringify(aiConfig));
            } else {
                localStorage.removeItem('destinyAiConfig');
            }
            
            // è·³è½¬åˆ°å‘½è¿è½¨è¿¹é¡µé¢
            window.open('/destiny-track', '_blank');
        }
        
        // å¤åˆ¶åŠŸèƒ½ - å…¼å®¹å¤–ç½‘è®¿é—®
        async function copyToClipboard(text, button) {
            const originalText = button.textContent;
            
            try {
                // æ–¹æ³•1: å°è¯•ä½¿ç”¨ç°ä»£å‰ªè´´æ¿API
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(text);
                    showCopySuccess(button, originalText);
                    return;
                }
                
                // æ–¹æ³•2: ä½¿ç”¨ä¼ ç»Ÿçš„execCommandæ–¹æ³•ï¼ˆå…¼å®¹æ›´å¤šç¯å¢ƒï¼‰
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    showCopySuccess(button, originalText);
                } else {
                    throw new Error('execCommand failed');
                }
            } catch (err) {
                // æ–¹æ³•3: æ˜¾ç¤ºæ–‡æœ¬è®©ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶
                showTextModal(text, button, originalText);
            }
        }
        
        function showCopySuccess(button, originalText) {
            button.textContent = 'âœ… å·²å¤åˆ¶';
            button.classList.add('copy-success');
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('copy-success');
            }, 2000);
        }
        
        function showTextModal(text, button, originalText) {
            // åˆ›å»ºæ¨¡æ€æ¡†æ˜¾ç¤ºæ–‡æœ¬ä¾›ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                padding: 20px;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; border-radius: 15px; padding: 30px;
                max-width: 90%; max-height: 80%; overflow-y: auto;
                position: relative;
            `;
            
            content.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">ğŸ“‹ è¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹å†…å®¹</h3>
                <textarea readonly style="width: 100%; min-height: 300px; padding: 15px; 
                    border: 2px solid #ddd; border-radius: 8px; font-family: monospace;
                    resize: vertical; font-size: 14px; line-height: 1.4;">${text}</textarea>
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="selectAllText(this)" style="background: #4ECDC4; color: white; 
                        border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;
                        margin-right: 10px;">å…¨é€‰æ–‡æœ¬</button>
                    <button onclick="closeModal(this)" style="background: #6c5ce7; color: white; 
                        border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">å…³é—­</button>
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬
            const textarea = content.querySelector('textarea');
            textarea.focus();
            textarea.select();
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
            
            // å…¨å±€å‡½æ•°ï¼šå…¨é€‰æ–‡æœ¬
            window.selectAllText = function(btn) {
                const textarea = btn.parentElement.parentElement.querySelector('textarea');
                textarea.focus();
                textarea.select();
                btn.textContent = 'âœ… å·²é€‰ä¸­';
                setTimeout(() => {
                    btn.textContent = 'å…¨é€‰æ–‡æœ¬';
                }, 1000);
            };
            
            // å…¨å±€å‡½æ•°ï¼šå…³é—­æ¨¡æ€æ¡†
            window.closeModal = function(btn) {
                const modal = btn.closest('div[style*="position: fixed"]');
                if (modal) {
                    document.body.removeChild(modal);
                }
            };
        }
        
        function copyShengxiaoInfo() {
            if (!currentAnalysisData) return;
            
            const birthInfo = currentAnalysisData.birth_info;
            const shengxiao = currentAnalysisData.shengxiao_analysis;
            
            const text = `ç”Ÿè‚–åˆ†æ - ${birthInfo.shengxiao}
            
åŸºæœ¬ä¿¡æ¯ï¼š
å‡ºç”Ÿæ—¥æœŸï¼š${birthInfo.date} (${birthInfo.calendar_type})
å‡ºç”Ÿæ—¶è¾°ï¼š${getTimeLabel(birthInfo.time)}
æ€§åˆ«ï¼š${birthInfo.gender}
ç”Ÿè‚–ï¼š${birthInfo.shengxiao}
å¹´æ”¯ï¼š${shengxiao.year_zhi}

ç›¸åˆç”Ÿè‚–ï¼š
ä¸‰åˆï¼š${shengxiao.compatible.sanhe.join('ã€') || 'æ— '}
å…­åˆï¼š${shengxiao.compatible.liuhe.join('ã€') || 'æ— '}
ä¸‰ä¼šï¼š${shengxiao.compatible.sanhui.join('ã€') || 'æ— '}

ä¸åˆç”Ÿè‚–ï¼š
ç›¸å†²ï¼š${shengxiao.incompatible.chong.join('ã€') || 'æ— '}
ç›¸åˆ‘ï¼š${shengxiao.incompatible.xing.join('ã€') || 'æ— '}
è¢«åˆ‘ï¼š${shengxiao.incompatible.beixing.join('ã€') || 'æ— '}
ç›¸å®³ï¼š${shengxiao.incompatible.hai.join('ã€') || 'æ— '}
ç›¸ç ´ï¼š${shengxiao.incompatible.po.join('ã€') || 'æ— '}

è¯´æ˜ï¼šåˆç”Ÿè‚–æ˜¯åˆå…«å­—çš„ä¸€å°éƒ¨åˆ†ï¼Œæœ‰ä¸€å®šå‚è€ƒæ„ä¹‰ï¼Œä½†ä¸æ˜¯å…¨éƒ¨ã€‚åˆå©šè¯·ä»¥å…«å­—ä¸ºå‡†ã€‚`;
            
            copyToClipboard(text, event.target);
        }
        
        function copyBaziInfo() {
            if (!currentAnalysisData) return;
            
            const birthInfo = currentAnalysisData.birth_info;
            const baziText = formatBaziContent(currentAnalysisData.bazi_analysis);
            
            const text = `å…«å­—æ’ç›˜
            
åŸºæœ¬ä¿¡æ¯ï¼š
å‡ºç”Ÿæ—¥æœŸï¼š${birthInfo.date} (${birthInfo.calendar_type})
å‡ºç”Ÿæ—¶è¾°ï¼š${getTimeLabel(birthInfo.time)}
æ€§åˆ«ï¼š${birthInfo.gender}
ç”Ÿè‚–ï¼š${birthInfo.shengxiao}

å…«å­—è¯¦ç»†åˆ†æï¼š
${baziText}`;
            
            copyToClipboard(text, event.target);
        }
        
        function copyAllInfo() {
            if (!currentAnalysisData) return;
            
            const birthInfo = currentAnalysisData.birth_info;
            const shengxiao = currentAnalysisData.shengxiao_analysis;
            const baziText = formatBaziContent(currentAnalysisData.bazi_analysis);
            
            const text = `å…«å­—ç”Ÿè‚–åˆ†ææŠ¥å‘Š
            
åŸºæœ¬ä¿¡æ¯ï¼š
å‡ºç”Ÿæ—¥æœŸï¼š${birthInfo.date} (${birthInfo.calendar_type})
å‡ºç”Ÿæ—¶è¾°ï¼š${getTimeLabel(birthInfo.time)}
æ€§åˆ«ï¼š${birthInfo.gender}
ç”Ÿè‚–ï¼š${birthInfo.shengxiao}
å¹´æ”¯ï¼š${shengxiao.year_zhi}

=== ç”Ÿè‚–åˆ†æ ===
ç›¸åˆç”Ÿè‚–ï¼š
ä¸‰åˆï¼š${shengxiao.compatible.sanhe.join('ã€') || 'æ— '}
å…­åˆï¼š${shengxiao.compatible.liuhe.join('ã€') || 'æ— '}
ä¸‰ä¼šï¼š${shengxiao.compatible.sanhui.join('ã€') || 'æ— '}

ä¸åˆç”Ÿè‚–ï¼š
ç›¸å†²ï¼š${shengxiao.incompatible.chong.join('ã€') || 'æ— '}
ç›¸åˆ‘ï¼š${shengxiao.incompatible.xing.join('ã€') || 'æ— '}
è¢«åˆ‘ï¼š${shengxiao.incompatible.beixing.join('ã€') || 'æ— '}
ç›¸å®³ï¼š${shengxiao.incompatible.hai.join('ã€') || 'æ— '}
ç›¸ç ´ï¼š${shengxiao.incompatible.po.join('ã€') || 'æ— '}

=== å…«å­—è¯¦ç»†åˆ†æ ===
${baziText}

è¯´æ˜ï¼šåˆç”Ÿè‚–æ˜¯åˆå…«å­—çš„ä¸€å°éƒ¨åˆ†ï¼Œæœ‰ä¸€å®šå‚è€ƒæ„ä¹‰ï¼Œä½†ä¸æ˜¯å…¨éƒ¨ã€‚åˆå©šè¯·ä»¥å…«å­—ä¸ºå‡†ã€‚`;
            
            copyToClipboard(text, event.target);
        }
    </script>
</body>
</html>